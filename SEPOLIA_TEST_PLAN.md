# 🧪 Sepolia测试计划

## 📋 测试概述

本测试计划涵盖了Leafswap项目在Sepolia测试网上的全面功能测试，包括基础功能、MEV保护、流动性管理和代币交换等核心功能。

## 🎯 测试目标

1. **验证合约部署正确性**
2. **测试MEV保护功能**
3. **验证流动性管理**
4. **测试代币交换功能**
5. **检查前端集成**
6. **验证安全机制**

## 📦 测试脚本

### 1. 基础验证测试
```bash
# 验证部署状态
npx hardhat run --network sepolia scripts/verify-deployment.js

# 检查账户余额
npx hardhat run --network sepolia scripts/check-balance.js
```

### 2. 代币功能测试
```bash
# 测试代币转账
npx hardhat run --network sepolia scripts/test-token-transfer.js
```

### 3. MEV保护测试
```bash
# 测试MEV保护功能
npx hardhat run --network sepolia scripts/test-mev-protection.js
```

### 4. 流动性管理测试
```bash
# 测试流动性管理
npx hardhat run --network sepolia scripts/test-liquidity.js
```

### 5. 代币交换测试
```bash
# 测试代币交换
npx hardhat run --network sepolia scripts/test-token-swap.js
```

## 🔍 详细测试内容

### 测试1: 基础验证测试

**目标:** 验证所有合约正确部署和配置

**测试内容:**
- [ ] SubcriptionConsumer合约状态
- [ ] MEVGuard合约配置
- [ ] Factory合约权限
- [ ] Router合约连接
- [ ] 测试代币状态
- [ ] 网络连接状态

**预期结果:**
- 所有合约地址正确
- 配置参数符合预期
- 权限设置正确

### 测试2: 代币功能测试

**目标:** 验证ERC20代币基本功能

**测试内容:**
- [ ] 代币余额查询
- [ ] 代币转账功能
- [ ] 多用户间转账
- [ ] 余额变化验证

**预期结果:**
- 转账成功执行
- 余额正确更新
- 事件正确触发

### 测试3: MEV保护测试

**目标:** 验证MEV保护机制

**测试内容:**
- [ ] MEVGuard配置验证
- [ ] 用户MEV保护开关
- [ ] 防抢跑保护状态
- [ ] MEV费用计算
- [ ] 最小交易规模限制
- [ ] 工厂权限验证

**预期结果:**
- MEV保护配置正确
- 用户保护状态可切换
- 费用计算准确
- 权限控制有效

### 测试4: 流动性管理测试

**目标:** 验证流动性池管理功能

**测试内容:**
- [ ] 交易对创建
- [ ] 流动性添加
- [ ] 储备金状态
- [ ] LP代币余额
- [ ] 工厂统计信息

**预期结果:**
- 交易对成功创建
- 流动性正确添加
- 储备金准确更新
- LP代币正确发放

### 测试5: 代币交换测试

**目标:** 验证代币交换功能

**测试内容:**
- [ ] 交换计算
- [ ] 滑点保护
- [ ] 实际交换执行
- [ ] 余额变化验证
- [ ] 价格影响计算
- [ ] 储备金更新

**预期结果:**
- 交换成功执行
- 滑点保护有效
- 价格影响合理
- 储备金正确更新

## 🌐 前端集成测试

### 测试6: 前端功能测试

**目标:** 验证前端与合约集成

**测试内容:**
- [ ] 钱包连接
- [ ] 网络切换
- [ ] 合约地址加载
- [ ] MEV保护开关
- [ ] 代币余额显示
- [ ] 交易执行

**测试步骤:**
1. 访问前端界面
2. 连接MetaMask钱包
3. 切换到Sepolia网络
4. 测试各项功能

**预期结果:**
- 钱包连接成功
- 网络切换正常
- 功能响应正确
- 交易执行成功

## 🔒 安全测试

### 测试7: 安全机制测试

**目标:** 验证安全保护机制

**测试内容:**
- [ ] 权限控制
- [ ] 输入验证
- [ ] 重入攻击防护
- [ ] 溢出保护
- [ ] 异常处理

**预期结果:**
- 权限控制有效
- 输入验证正确
- 安全机制工作正常

## 📊 性能测试

### 测试8: 性能测试

**目标:** 验证系统性能

**测试内容:**
- [ ] Gas费用优化
- [ ] 交易确认时间
- [ ] 并发处理能力
- [ ] 内存使用情况

**预期结果:**
- Gas费用合理
- 交易确认及时
- 性能表现良好

## 🚨 错误处理测试

### 测试9: 错误场景测试

**目标:** 验证错误处理机制

**测试内容:**
- [ ] 余额不足
- [ ] 滑点过大
- [ ] 交易过期
- [ ] 网络错误
- [ ] 合约错误

**预期结果:**
- 错误信息清晰
- 回滚机制正常
- 用户体验良好

## 📝 测试执行顺序

### 第一阶段: 基础验证
1. 运行 `verify-deployment.js`
2. 运行 `check-balance.js`

### 第二阶段: 功能测试
3. 运行 `test-token-transfer.js`
4. 运行 `test-mev-protection.js`

### 第三阶段: 核心功能
5. 运行 `test-liquidity.js`
6. 运行 `test-token-swap.js`

### 第四阶段: 集成测试
7. 前端功能测试
8. 端到端测试

## 📈 测试指标

### 成功标准
- ✅ 所有测试脚本执行成功
- ✅ 合约功能正常工作
- ✅ 前端集成无错误
- ✅ 安全机制有效
- ✅ 性能表现良好

### 失败标准
- ❌ 任何测试脚本失败
- ❌ 合约功能异常
- ❌ 前端集成错误
- ❌ 安全漏洞存在
- ❌ 性能问题严重

## 🔧 测试环境

### 网络配置
- **网络:** Sepolia测试网
- **Chain ID:** 11155111
- **RPC URL:** 配置在 `.env` 文件中
- **账户:** 使用部署账户和测试账户

### 合约地址
- **SubcriptionConsumer:** `0x5CC1a5329E91Fd5424afd03C42d803DC43904873`
- **MEVGuard:** `0x1527Db198B15099A78209E904aDCcD762EC250E5`
- **Factory:** `0x2dABACdbDf93C247E681E3D7E124B61f311D6Fd9`
- **Router:** `0x7d02eD568a1FD8048dc4FDeD9895a40356A47782`
- **Token A:** `0x198921c2Ca38Ee088cF65bFF5327249b1D23409e`
- **Token B:** `0x0eD732A13D4432EbF0937E5b0F6B64d3DA8F7627`

## 📞 问题报告

如果测试过程中遇到问题：

1. **记录错误信息**
2. **保存交易哈希**
3. **截图错误界面**
4. **检查网络状态**
5. **验证账户余额**

## 🎉 测试完成

完成所有测试后，您的Leafswap项目将：
- ✅ 在Sepolia测试网上正常运行
- ✅ 具备完整的MEV保护功能
- ✅ 支持代币交换和流动性管理
- ✅ 前端界面完全可用
- ✅ 准备好在主网上部署

---

**开始测试吧！🚀**
